# WJetsTreeAnalysis16

The instructions for running the W+jets 13TeV analysis code on bonzai ntuples (data and MC) for 2016 data provided by Kadir Ocalan and Metin Yalvac.

If you are interested in 2015 data/MC, please see Apichart's repository here:
https://github.com/ahortian/WJetsTreeAnalysis/tree/master/WJets

Note: the unfolding of these data is done at a different step, this code produces reco-level plots. Previously, for 2015 13 TeV we have used RooUnfold, with the Bayesian iterative method (::kBayes):
https://github.com/ahortian/WJets13TeVUnfolding

-- For now use CMSSW_5_3_20
cmsrel CMSSW_5_3_20  
cd CMSSW_5_3_20/src
cmsenv 

-- Clone /WJetsTreeAnalysis from the github
git clone https://github.com/awisecar/WJetsTreeAnalysis16.git
or
git clone git@github.com:awisecar/WJetsTreeAnalysis16.git

-- Go to the directory 
cd WJetsTreeAnalysis16/WJets

-- Compile RooUnfold
cd RooUnfold
make clean
make
cd -

-- Ready to run the code!!! 

Two different approaches to running:

1) python wjets_jobsub.py
which will submit batch jobs for the values of doWhat, doQCD, and doSysRunning specified in the script, producing STDOUT, and the submitted shell scripts in the folder "tmpjobs_<date>"

2) root -b -q wjets_compileCode.cc
   root -b -q runDYJets.cc
first compiles the code anew, and then the main command, which will be run in your current shell.

Note: for QCD multijets background estimation we use the "ABCD" data-driven method, so we must run over the one signal and three control regions, doQCD=0, 1...3, respectively.
The doWhat, doQCD, doSysRunning, and doBJets options tell the main code (Sources/ZJetsAndDPS.cc) what you'd like to run

-- Output root files are in the directory HistoFiles. 

-- Merge each of the separate datafiles. (The data batch jobs are split into separate lists -- see runDYJets.cc -- and submitted separately to speed up the process.) This shell script uses the 'hadd' command to combine several rootfiles into one.
./wjets_Merge_Data_BVeto.sh
./wjets_Merge_Wpt_BVeto.sh

-- Merge single top and DYJets root files (change if your total number of top or DY MC samples changes):
root -b -q MergeTop_BVeto.cc++
root -b -q MergeVV_BVeto.cc++

-- Merge QCD Background:
root -b -q runQCD_BVeto.cc++
or if you want to save the output --
root -b -q runQCD_BVeto.cc++ > mergeQCD.out 2>&1 

-- Plotting: After you have all needed output files, you can plot the histograms by
root -b -q runTest_BVeto.cc++

--Congratulations! Output PDF files will be in the directory PNGFile
A .tex file detailing the bin statistics will be available in WJets directory with title beginning with "outputTable_"

----------------------------------
Systematics:
./wjets_Merge_Data_Syst.sh
./wjets_Merge_Wpt_Syst.sh
//Note: for single top, go in and change the syst switches as needed, but it's the same file to merge them
root -b -q -l MergeTop_BVeto.cc


----------------------------------

TTbar SFs Study:
Run requiring 2 btag jets (doBJets=2) and WJets signal region (doQCD=0)
We neglect QCD BG here.

./wjets_mergeDataBJets.sh

root -b -q MergeTop_BJets.cc
root -b -q MergeVV_BJets.cc
//Note: We don't used QCD BG for ttbar study, but if one is so inclined, they can create it using this command:
root -b -q runQCD_BJets.cc

//if(doTTScale), then ttbar SFs are applied in getStatistics function to print out the statistics tables
//ttbar SFs are applied in Plotter.cc when plotting the distributions (but original files not altered)
root -b -q runTest_BJets.cc++
